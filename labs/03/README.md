# Лабораторная работа №3

- [Лабораторная работа №3](#лабораторная-работа-3)
  - [Задания](#задания)
    - [Задание 1 — signal-handler — 50 баллов](#задание-1--signal-handler--50-баллов)
    - [Задание 2 — Иван Грозный убивает своего сына — 70 баллов](#задание-2--иван-грозный-убивает-своего-сына--70-баллов)

## Задания

- Для получения оценки "удовлетворительно" нужно набрать не менее 50 баллов.
- На оценку хорошо нужно набрать не менее 100 баллов.
- Для получения оценки "отлично" нужно набрать не менее 150 баллов.

### Задание 1 — signal-handler — 50 баллов

Разработайте кроссплатформенную программу **signal-handler**, которая
создаёт в текущем каталоге файл *temp.txt*, а затем каждую секунду выводит
в стандартный поток последовательные числа от 0 до 100.
В конце своей работы программа должна удалить файл *temp.txt* и вывести текст
«Done».

Чтобы сделать паузу, используйте функцию [`std::this_thread::sleep_for`](https://en.cppreference.com/w/cpp/thread/sleep_for).
Чтобы удалить файл, используйте функцию [`std::filesystem::remove`](https://en.cppreference.com/w/cpp/filesystem/remove).

Если во время работы программы нажать Ctrl+C, то программа завершит работу,
не выполнив завершающих действий: не удалит временный файл *temp.txt* и не выведет текст «Done».
То же самое произойдёт и при команды `kill id-процесса`.

Используйте механизмы обработки сигналов, чтобы ваша программа могла обработать сигнал о прерывании работы и завершить работу.

Вам пригодится функция [`signal`](https://man7.org/linux/man-pages/man2/signal.2.html) (реализована под Windows и Linux)
или [`sigaction`](https://man7.org/linux/man-pages/man2/sigaction.2.html)
(последняя не реализована под Windows), чтобы задать обработчик сигналов.

Задайте обработчики сигналов `SIGINT` (прерывание работы программы с клавиатуры)
и `SIGTERM` (сигнал о завершении работы программы).

В обработчике сигнала установите флаг, который периодически проверяется в программе,
чтобы сообщить ей о необходимости завершения работы.

Внимание, под ОС Windows обработчик сигнала вызывается в отдельном потоке.
Под Linux обработчик вызывается в основном потоке.
Чтобы избежать состояния гонки при конкурентном обращении нескольких потоков к флагу завершения,
сделайте флаг атомарной переменной. Для этого подойдут типы
[`std::atomic_flag`](https://en.cppreference.com/w/cpp/atomic/atomic_flag)
или [`std::atomic_bool`](https://en.cppreference.com/w/cpp/atomic/atomic).

Изучите работу команды [`kill`](https://man7.org/linux/man-pages/man1/kill.1.html)
и [`ps`](https://man7.org/linux/man-pages/man1/ps.1.html).
Запустите в одном окне консоли Lunux экземпляр вашей программы,
а в другом окне узнайте ёё pid командой `ps`.
Используйте `kill`, чтобы завершить работу процесса. Убедитесь, что процесс завершился штатным образом.

### Задание 2 — Иван Грозный убивает своего сына — 70 баллов

Ознакомьтесь с работой функции [`kill`](https://man7.org/linux/man-pages/man2/kill.2.html).
Напишите Linux-программу **kill-child**, которая считывает со стандартного ввода команды и выполняет их.

- Команда `exit` завершает работу программы.
- Команда `spawn` запускает дочерний процесс функцией `fork`.
  Дочерний процесс должен ждать сигналы SIGTERM и SIGINT и
  каждые 5 секунд выводить надпись «Child process ID-процесса is still alive».
- Команда `kill` посылает сигнал SIGTERM очередному дочернему процессу и дожидается его завершения.
  Если дочерних процессов не осталось, выведите сообщение: «No children to kill»

Если родительский процесс завершил работу, а дочерние ещё нет,
используйте команду `kill` в другом окне консоли, чтобы завершить их.
