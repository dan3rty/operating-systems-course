# Лабораторная работа №2

- [Лабораторная работа №2](#лабораторная-работа-2)
  - [Задания](#задания)
    - [Требования](#требования)
    - [Задание 1 — list-processes-win — 50 баллов](#задание-1--list-processes-win--50-баллов)
    - [Задание 2 — list-process-linux — 50 баллов](#задание-2--list-process-linux--50-баллов)
    - [Задание 3 — zombie — 30 баллов](#задание-3--zombie--30-баллов)
      - [Подсказки](#подсказки)
    - [Задание 4 — flip-case — 70 баллов](#задание-4--flip-case--70-баллов)
  - [Ссылки](#ссылки)

## Задания

- Для получения оценки "удовлетворительно" нужно набрать не менее 100 баллов.
- На оценку хорошо нужно набрать не менее 150 баллов.
- Для получения оценки "отлично" нужно набрать не менее 180 баллов.

### Требования

Обязательно проверяйте успешность всех вызовов функций операционной системы и не оставляйте ошибки незамеченными.

Ваш код должен иметь уровень безопасности исключений не ниже базового.
Для этого разработайте (или возьмите готовую) RAII-обёртку, автоматизирующую
управление ресурсами операционной системы.

### Задание 1 — list-processes-win — 50 баллов

Напишите консольную программу **list-processes-win** для ОС Windows, которая выводит информацию о запущенных
в настоящий момент процессах:

- pid процесса
- имя исполняемого файла
- количество потребляемой процессом памяти

### Задание 2 — list-process-linux — 50 баллов

Напишите консольную программу **list-processes-linux** для ОС Linux, которая выводит информацию о запущенных
в настоящий момент процессах:

- pid процесса
- имя исполняемого файла
- количество потребляемой процессом памяти

### Задание 3 — zombie — 30 баллов

Ознакомьтесь с работой системных вызовов [`fork`](https://man7.org/linux/man-pages/man2/fork.2.html)
и [waitpid](https://man7.org/linux/man-pages/man2/wait.2.html) в ОС Linux.
Напишите программу zombie, которая:

- порождает дочерний процесс функцией `fork`. Дочерний процесс должен вывести свой pid и завершить работу.
  При этом дочерний останется в состоянии зомби, пока родительский процесс не дождётся его завершения.
- Родительский процесс должен запросить у пользователя pid дочернего процесса и дождаться
  завершения его работы, используя функцию `waitpid`.
- Если пользователь ввёл неверный pid и функция `waitpid` завершилась неудачей,
  то нужно запросить pid дочернего процесса заново и повторить ожидание.

После того, как отладите работу, усложните свою задачу и доработайте программу,
чтобы дочерний процесс не выводил свой pid перед выходом.

Ознакомьтесь с работой команд [`top`](https://man7.org/linux/man-pages/man1/top.1.html) и
[`ps`](https://man7.org/linux/man-pages/man1/ps.1.html). Во втором окне консоли используйте эти команды,
чтобы определить pid дочернего процесса-зомби.

#### Подсказки

Процесс может получить свой идентификатор процесса функцией
[`getpid`](https://man7.org/linux/man-pages/man2/getpid.2.html).

### Задание 4 — flip-case — 70 баллов

Ознакомьтесь с работой системного вызова [`fork`](https://man7.org/linux/man-pages/man2/fork.2.html) в ОС Linux.
Напишите с его использованием консольное приложение **flip-case**. Это приложение принимает произвольное количество
параметров командной строки, задающих имена файлов.
Для обработки каждого из этих файлов оно должно запустить дочерний процесс функцией `fork`.
Дочерний процесс должен посимвольно скопировать содержимое входного файла в выходной,
изменяя регистр английских символов на противоположный.
Имя выходного файла получается путём добавления расширения *.out* к имени входного файла.

Например, следующая команда должна создать файлы *input1.txt.out* и *input2.txt.out*, на основе файлов
*input1.txt* и *input2.txt*.

```bash
flip-case input1.txt input2.txt
```

Для наглядности дочерний процесс должен перед началом своей работы вывести свой pid и
сообщение о начале обработки входного файла, а в конце — свой pid и сообщение
о готовности выходного файла.
Родительский процесс должен дождаться конца работы дочерних процессов и вывести
сообщения об их завершении.

Пример вывода:

```bash
flip-case input1.txt input2.txt
```

```txt
Process 82372 is processing input1.txt
Process 82373 is processing input2.txt
Process 82373 has finished writing to input2.txt.out
Child process 82373 is over
Process 82372 has finished writing to input1.txt.out
Child process 82372 is over
```

Здесь сообщения «Process X is processing Y» и «Process X has finished writing to Y.out»
выводятся дочерним процессом, а «Child process X is over» — родительским.

## Ссылки

- [Создание процессов с помощью вызова fork](https://www.opennet.ru/docs/RUS/linux_parallel/node7.html)
- [Windows Process Status API](https://learn.microsoft.com/en-us/windows/win32/api/_psapi/)
- [Linux /proc filesystem](https://docs.kernel.org/filesystems/proc.html)
